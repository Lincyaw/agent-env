# Default values for arl-operator
# This is a YAML-formatted file.

replicaCount: 1

image:
  repository: arl-operator
  pullPolicy: IfNotPresent
  tag: "latest"

sidecar:
  image:
    repository: arl-sidecar
    pullPolicy: IfNotPresent
    tag: "latest"
  httpPort: 8080
  grpcPort: 9090

# Executor agent configuration
executorAgent:
  image:
    repository: arl-executor-agent
    pullPolicy: IfNotPresent
    tag: "latest"

# Gateway configuration
gateway:
  enabled: true
  replicaCount: 1
  image:
    repository: arl-gateway
    pullPolicy: IfNotPresent
    tag: "latest"
  port: 8080
  sidecarGrpcPort: 9090
  serviceAccount:
    name: ""
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext: {}

securityContext: {}

resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}

tolerations: []

affinity: {}

# Operator configuration
operator:
  metricsAddr: ":8080"
  probeAddr: ":8081"
  enableLeaderElection: true
  enableWebhooks: false
  enableMetrics: true
  enableMiddleware: true
  workspaceDir: "/workspace"
  httpClientTimeout: "30s"

# Pool configuration
pool:
  defaultReplicas: 3
  defaultRequeueDelay: "10s"
  sandboxCheckInterval: "2s"

# Sandbox lifecycle configuration
sandbox:
  idleTimeoutSeconds: 3600
  maxLifetimeSeconds: 0

# ClickHouse configuration (for audit logging and trajectory)
clickhouse:
  # Enable ClickHouse deployment
  enabled: false
  # Image (use private registry since nodes cannot access Docker Hub)
  image:
    repository: pair-diag-cn-guangzhou.cr.volces.com/pair/clickhouse-server
    tag: "24.8"
    pullPolicy: IfNotPresent
  # Connection settings
  host: ""  # auto-resolved via helper to <fullname>-clickhouse
  port: 9000
  database: "arl"
  username: "default"
  # REQUIRED: Must be set by the user. Do not use a default password.
  password: "clickhouse123"
  batchSize: 100
  flushInterval: "10s"
  # Data retention
  retentionDays: 30
  # Storage configuration
  storageClassName: "ebs-ssd"
  storageSize: "10Gi"
  # Service configuration
  serviceType: "ClusterIP"
  # httpNodePort: 30123   # Port for HTTP interface (8123) - uncomment if serviceType is NodePort
  # nativeNodePort: 30000 # Port for native protocol (9000) - uncomment if serviceType is NodePort
  # Resources
  resources:
    requests:
      cpu: 500m
      memory: 4Gi
    limits:
      cpu: "16"
      memory: 32Gi

# CRD installation
crds:
  install: true
  keep: true

# ─────────────────────────────────────────────────────────────────────────────
# Prometheus
# ─────────────────────────────────────────────────────────────────────────────
prometheus:
  enabled: true
  image: pair-diag-cn-guangzhou.cr.volces.com/pair/prometheus:v3.10.0
  service:
    type: ClusterIP
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi
  persistence:
    enabled: false
    storageClass: ebs-ssd
    size: 20Gi

# ─────────────────────────────────────────────────────────────────────────────
# Grafana
# ─────────────────────────────────────────────────────────────────────────────
grafana:
  enabled: true
  image: pair-diag-cn-guangzhou.cr.volces.com/pair/grafana:12.3.1
  adminUser: admin
  adminPassword: admin  # CHANGE in production
  service:
    type: ClusterIP
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  persistence:
    enabled: false
    storageClass: ebs-ssd
    size: 20Gi

# ─────────────────────────────────────────────────────────────────────────────
# Metrics / Prometheus scraping
# ─────────────────────────────────────────────────────────────────────────────
metrics:
  # Creates a dedicated ClusterIP Service exposing the operator's /metrics port
  service:
    enabled: true
    port: 8080
    targetPort: metrics
  # Creates VMServiceScrape (VictoriaMetrics) for both operator and gateway.
  serviceMonitor:
    enabled: true
    interval: "15s"
    # Labels required by the VictoriaMetrics agent in this cluster
    additionalLabels:
      volcengine.vmp: "true"
  # Creates standard Prometheus ServiceMonitor (monitoring.coreos.com/v1)
  # Enable this if using kube-prometheus-stack instead of VictoriaMetrics.
  prometheusServiceMonitor:
    enabled: false
    interval: "15s"
    # Labels to match your Prometheus operator's serviceMonitorSelector
    # e.g. release: kube-prometheus-stack
    additionalLabels: {}
