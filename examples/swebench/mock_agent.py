"""Mock agent for simulating LLM agent behavior in SWE-bench scenarios.

This module provides a simple mock agent that can simulate basic LLM agent
behavior for testing and demonstration purposes.
"""

from pathlib import Path
from typing import Any


class MockAgent:
    """Mock agent that simulates LLM agent behavior.

    This agent reads predefined inputs from fixture files and returns
    them as if they were generated by an actual LLM agent.

    Attributes:
        fixtures_dir: Directory containing fixture files for agent I/O
    """

    def __init__(self, fixtures_dir: str | Path = "swebench_fixtures") -> None:
        """Initialize mock agent.

        Args:
            fixtures_dir: Path to directory containing fixture files
        """
        self.fixtures_dir = Path(fixtures_dir)

    def read_fixture(self, filename: str) -> str:
        """Read content from a fixture file.

        Args:
            filename: Name of the fixture file

        Returns:
            Content of the fixture file

        Raises:
            FileNotFoundError: If fixture file doesn't exist
        """
        fixture_path = self.fixtures_dir / filename
        if not fixture_path.exists():
            raise FileNotFoundError(f"Fixture file not found: {fixture_path}")

        with open(fixture_path) as f:
            return f.read()

    def analyze_issue(self, issue_file: str = "issue_description.txt") -> dict[str, Any]:
        """Analyze the bug issue and return analysis.

        In a real agent, this would involve:
        - Reading the issue description
        - Analyzing the codebase
        - Identifying the root cause
        - Planning a fix strategy

        Args:
            issue_file: Name of the issue description file

        Returns:
            Dictionary containing issue analysis
        """
        issue_content = self.read_fixture(issue_file)

        return {
            "issue": issue_content,
            "severity": "medium",
            "category": "bug",
            "affected_file": "packages/emotion/src/index.js",
            "root_cause": "Direct style assignment instead of setAttribute",
            "fix_strategy": "Replace direct assignment with setAttribute method",
        }

    def generate_patch(self, patch_file: str = "agent_patch.diff") -> str:
        """Generate a code patch to fix the issue.

        In a real agent, this would involve:
        - Understanding the codebase
        - Generating the fix code
        - Creating a proper diff/patch

        Args:
            patch_file: Name of the patch file

        Returns:
            Patch content as string
        """
        return self.read_fixture(patch_file)

    def generate_test_script(self, test_file: str = "test_script.sh") -> str:
        """Generate test script to verify the fix.

        In a real agent, this would involve:
        - Understanding existing tests
        - Creating new test cases
        - Generating verification scripts

        Args:
            test_file: Name of the test script file

        Returns:
            Test script content as string
        """
        return self.read_fixture(test_file)

    def generate_report(self, report_template: str = "fix_report_template.md") -> str:
        """Generate a fix report.

        In a real agent, this would involve:
        - Documenting the issue
        - Explaining the fix
        - Summarizing test results

        Args:
            report_template: Name of the report template file

        Returns:
            Report content as string
        """
        return self.read_fixture(report_template)

    def run_workflow(
        self,
    ) -> dict[str, Any]:
        """Run complete agent workflow.

        This simulates a complete agent workflow:
        1. Analyze issue
        2. Generate patch
        3. Generate tests
        4. Generate report

        Returns:
            Dictionary containing all agent outputs
        """
        return {
            "analysis": self.analyze_issue(),
            "patch": self.generate_patch(),
            "test_script": self.generate_test_script(),
            "report": self.generate_report(),
        }


def create_mock_agent(fixtures_dir: str | Path = "swebench_fixtures") -> MockAgent:
    """Factory function to create a mock agent.

    Args:
        fixtures_dir: Path to directory containing fixture files

    Returns:
        Configured MockAgent instance

    Example:
        >>> agent = create_mock_agent()
        >>> analysis = agent.analyze_issue()
        >>> patch = agent.generate_patch()
    """
    return MockAgent(fixtures_dir)
