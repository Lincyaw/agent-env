<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARL Interactive Shell</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            color: #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            margin-bottom: 20px;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #2d2d2d;
            border-radius: 5px;
        }
        .controls input, .controls select, .controls button {
            margin: 5px;
            padding: 8px 12px;
            border: 1px solid #444;
            background: #3d3d3d;
            color: #fff;
            border-radius: 3px;
        }
        .controls button {
            cursor: pointer;
            background: #007acc;
        }
        .controls button:hover {
            background: #005a9e;
        }
        .controls button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        #terminal {
            height: 600px;
            background: #000;
            padding: 10px;
            border-radius: 5px;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            background: #2d2d2d;
            border-radius: 5px;
            font-size: 14px;
        }
        .status.connected {
            border-left: 4px solid #4caf50;
        }
        .status.disconnected {
            border-left: 4px solid #f44336;
        }
        .status.connecting {
            border-left: 4px solid #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñ•Ô∏è ARL Interactive Shell</h1>

        <div class="controls">
            <label>Namespace:</label>
            <input type="text" id="namespace" value="default" />

            <label>Pod Name:</label>
            <input type="text" id="podName" placeholder="session-xxx-xxx" />

            <label>Container:</label>
            <select id="container">
                <option value="executor">executor</option>
                <option value="sidecar">sidecar</option>
            </select>

            <button id="connectBtn" onclick="connect()">Connect</button>
            <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
        </div>

        <div id="terminal"></div>

        <div id="status" class="status disconnected">
            Status: Disconnected
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>

    <script>
        let ws = null;
        let term = null;
        let fitAddon = null;

        // Initialize terminal
        function initTerminal() {
            term = new Terminal({
                cursorBlink: true,
                fontSize: 14,
                fontFamily: 'Menlo, Monaco, "Courier New", monospace',
                theme: {
                    background: '#000000',
                    foreground: '#ffffff'
                }
            });

            fitAddon = new FitAddon.FitAddon();
            term.loadAddon(fitAddon);
            term.open(document.getElementById('terminal'));
            fitAddon.fit();

            // Handle terminal input
            term.onData(data => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'input',
                        data: data
                    }));
                }
            });

            // Handle window resize
            window.addEventListener('resize', () => {
                fitAddon.fit();
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'resize',
                        rows: term.rows,
                        cols: term.cols
                    }));
                }
            });
        }

        function connect() {
            const namespace = document.getElementById('namespace').value;
            const podName = document.getElementById('podName').value;
            const container = document.getElementById('container').value;

            if (!podName) {
                alert('Please enter a pod name');
                return;
            }

            updateStatus('connecting', 'Connecting...');

            // Connect to WebSocket server
            // Change this URL to your server address
            const wsUrl = `ws://localhost:8000/ws/shell/${namespace}/${podName}?container=${container}`;
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('WebSocket connected');
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);

                switch (data.type) {
                    case 'connected':
                        updateStatus('connected', `Connected to ${data.pod_name} (${data.container})`);
                        document.getElementById('connectBtn').disabled = true;
                        document.getElementById('disconnectBtn').disabled = false;
                        term.focus();
                        break;

                    case 'output':
                        term.write(data.data);
                        break;

                    case 'error':
                        term.writeln(`\r\n\x1b[31mError: ${data.message}\x1b[0m\r\n`);
                        updateStatus('disconnected', `Error: ${data.message}`);
                        break;

                    case 'closed':
                        disconnect();
                        break;
                }
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                updateStatus('disconnected', 'Connection error');
            };

            ws.onclose = () => {
                console.log('WebSocket closed');
                updateStatus('disconnected', 'Disconnected');
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('disconnectBtn').disabled = true;
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
            term.clear();
            updateStatus('disconnected', 'Disconnected');
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('disconnectBtn').disabled = true;
        }

        function updateStatus(state, message) {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${state}`;
            statusEl.textContent = `Status: ${message}`;
        }

        // Initialize on page load
        window.onload = () => {
            initTerminal();
        };
    </script>
</body>
</html>
